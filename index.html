<!DOCTYPE html>
<html lang="es">
<head>
  

  <link rel="icon" href="https://cinepolis.com/icon.png"></link>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

  <meta charset="UTF-8">
  <title>Seguimiento de KDMs</title>
  <style>body {
  background-color: #F5F5F5; /* White Smoke */
  color: #333;
  font-family: 'Segoe UI', sans-serif;
}</style>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
  </style>
</head>

<script>
  const supabase = window.supabase.createClient(
    'https://loeuwyskdvvxjgxjerah.supabase.co',
    'TU_API_KEY_PUBLICA'
  );

  async function cargarRegistros() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      alert('Debes iniciar sesi√≥n');
      return;
    }

    const { data, error } = await supabase
      .from('kdms')
      .select('*')
      .eq('user_id', user.id);

    if (error) {
      console.error('Error al cargar registros:', error.message);
      return;
    }

    const tbody = document.querySelector('#tablaKDMs tbody');
    tbody.innerHTML = '';

    data.forEach(registro => {
      const fila = document.createElement('tr');
      fila.innerHTML = `
        <td>${registro['Pelicula'] || ''}</td>
        <td>${registro['CPL recibida'] ? '‚úÖ' : '‚ùå'}</td>
        <td>${registro['Fecha de cpl recibida'] || ''}</td>
        <td>${registro['KDM recibido'] ? '‚úÖ' : '‚ùå'}</td>
        <td>${registro['KDM ingestado'] ? '‚úÖ' : '‚ùå'}</td>
        <td>${registro['KDM abre'] || ''}</td>
      `;
      tbody.appendChild(fila);
    });
  }

  cargarRegistros();
</script>


<body>
  
  <img width="8%" loading="lazy" id="cinepolis_Logo" src="./logo-cinepolis-dos.webp">
  <h1>  Seguimiento de CPL y KDM</h1>
  <input type="text" id="filtroPelicula" placeholder="üîç Filtrar por pel√≠cula..." style="margin-top:10px; padding:5px; width:100%; background-color: F5F5F5;">
<button onclick="logout()">Cerrar sesi√≥n</button>
  <table id="dataTable"></table>

<table id="tablaKDMs">
  <thead>
    <tr>
      <th>Pelicula</th>
      <th>CPL recibida</th>
      <th>Fecha CPL</th>
      <th>KDM recibido</th>
      <th>KDM ingestado</th>
      <th>KDM abre</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const supabase = window.supabase.createClient(
      'https://loeuwyskdvvxjgxjerah.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvZXV3eXNrZHZ2eGpneGplcmFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwNTUwNDMsImV4cCI6MjA3MDYzMTA0M30.mZmOSQv8sfFeXRdVc9ru01-C8WLlRMp6e2dhf_6Imbw'
    );

    const { data: { session } } = await supabase.auth.getSession();

    if (!session) {
      window.location.href = '/login.html'; // Redirige si no hay sesi√≥n
    }
  });

</script>

<script>
  async function logout() {
    const supabase = window.supabase.createClient(
      'https://loeuwyskdvvxjgxjerah.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvZXV3eXNrZHZ2eGpneGplcmFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwNTUwNDMsImV4cCI6MjA3MDYzMTA0M30.mZmOSQv8sfFeXRdVc9ru01-C8WLlRMp6e2dhf_6Imbw'
    );
    await supabase.auth.signOut();
    window.location.href = '/login.html';
  }
</script>

</body>
</html>
